import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';

import { Observable } from 'rxjs/Observable';
import { of } from 'rxjs/observable/of';
import { catchError, map, tap } from 'rxjs/operators';
import { MagicItem } from '../model/magic-item'

@Injectable()
export class MagicItemsService {

  private railsServer = 'http://localhost:3000/'
  private magicItemsUrl = 'items/magic_items/weapons.json';  // URL to web api

  private mockMagicItems = `[{"name":"Arme magique","description":"Lorem","alteration":"Jet d'attaque et jet de dégâts.","property":"propriete","power":"pouvoir","critical":"+1D6 par bonus d'altération.","itemLevels":[{"level":1,"price":"360","alteration":"1"},{"level":6,"price":"1800","alteration":"2"},{"level":11,"price":"9000","alteration":"3"},{"level":16,"price":"45000","alteration":"4"},{"level":21,"price":"225000","alteration":"5"},{"level":26,"price":"1125000","alteration":"6"}],"itemGroups":[{"name":"Arbalètes"},{"name":"Arcs"},{"name":"Haches"}],"rarity":"common","source":{"name":"MdJ1"}},{"name":"Arme de feu","description":"Lorem feu","alteration":"Jet d'attaque et jet de dégâts.","property":"propriete","power":"pouvoir","critical":"+1D6 par bonus d'altération.","itemLevels":[{"level":1,"price":"360","alteration":"1"},{"level":6,"price":"1800","alteration":"2"},{"level":11,"price":"9000","alteration":"3"},{"level":16,"price":"45000","alteration":"4"},{"level":21,"price":"225000","alteration":"5"},{"level":26,"price":"1125000","alteration":"6"}],"itemGroups":[{"name":"Arbalètes"},{"name":"Arcs"},{"name":"Haches"}],"rarity":"common","source":{"name":"MdJ2"}},{"name":"Arme de froid","description":"Lorem glace","alteration":"Jet d'attaque et jet de dégâts.","property":"propriete","power":"pouvoir","critical":"+1D6 par bonus d'altération.","itemLevels":[{"level":1,"price":"360","alteration":"1"},{"level":6,"price":"1800","alteration":"2"},{"level":11,"price":"9000","alteration":"3"},{"level":16,"price":"45000","alteration":"4"},{"level":21,"price":"225000","alteration":"5"},{"level":26,"price":"1125000","alteration":"6"}],"itemGroups":[{"name":"Arbalètes"},{"name":"Arcs"},{"name":"Haches"}],"rarity":"common","source":{"name":"MdJ3"}},{"name":"Arme de foudre","description":"Lorem glace","alteration":"Jet d'attaque et jet de dégâts.","property":"propriete","power":"pouvoir","critical":"+1D6 par bonus d'altération.","itemLevels":[{"level":1,"price":"360","alteration":"1"},{"level":6,"price":"1800","alteration":"2"},{"level":11,"price":"9000","alteration":"3"},{"level":16,"price":"45000","alteration":"4"},{"level":21,"price":"225000","alteration":"5"},{"level":26,"price":"1125000","alteration":"6"}],"itemGroups":[{"name":"Arbalètes"},{"name":"Arcs"},{"name":"Haches"}],"rarity":"common","source":{"name":"MdJ3"}},{"name":"Arme de lumière","description":"Lorem glace","alteration":"Jet d'attaque et jet de dégâts.","property":"propriete","power":"pouvoir","critical":"+1D6 par bonus d'altération.","itemLevels":[{"level":1,"price":"360","alteration":"1"},{"level":6,"price":"1800","alteration":"2"},{"level":11,"price":"9000","alteration":"3"},{"level":16,"price":"45000","alteration":"4"},{"level":21,"price":"225000","alteration":"5"},{"level":26,"price":"1125000","alteration":"6"}],"itemGroups":[{"name":"Arbalètes"},{"name":"Arcs"},{"name":"Haches"}],"rarity":"common","source":{"name":"MdJ3"}},{"name":"Arme de sang","description":"Lorem glace","alteration":"Jet d'attaque et jet de dégâts.","property":"propriete","power":"pouvoir","critical":"+1D6 par bonus d'altération.","itemLevels":[{"level":1,"price":"360","alteration":"1"},{"level":6,"price":"1800","alteration":"2"},{"level":11,"price":"9000","alteration":"3"},{"level":16,"price":"45000","alteration":"4"},{"level":21,"price":"225000","alteration":"5"},{"level":26,"price":"1125000","alteration":"6"}],"itemGroups":[{"name":"Arbalètes"},{"name":"Arcs"},{"name":"Haches"}],"rarity":"common","source":{"name":"MdJ3"}},{"name":"Arme de fer","description":"Lorem glace","alteration":"Jet d'attaque et jet de dégâts.","property":"propriete","power":"pouvoir","critical":"+1D6 par bonus d'altération.","itemLevels":[{"level":1,"price":"360","alteration":"1"},{"level":6,"price":"1800","alteration":"2"},{"level":11,"price":"9000","alteration":"3"},{"level":16,"price":"45000","alteration":"4"},{"level":21,"price":"225000","alteration":"5"},{"level":26,"price":"1125000","alteration":"6"}],"itemGroups":[{"name":"Arbalètes"},{"name":"Arcs"},{"name":"Haches"}],"rarity":"common","source":{"name":"MdJ3"}}]`
  private mockMagicItems2 = `[{"id":114,"name":"Appel du gardien","description":"Ornée des symboles du vent et du chêne, cette arme accroît vos défenses quand vous êtes sous forme tutélaire.","alteration":"jets d'attaque et jets de dégâts","property":"Lorsque vous adoptez une forme tutélaire, choisissez une défense autre que la CA. Vous bénéficiez d'un bonus de +2 à cette défense tant que vous êtes sous forme tutélaire.","power":"","special":"","source_id":14,"rarity":"common","critical":"+1d6 dégâts par point de bonus d'altération, ou +1d10 dégâts par point de bonus d'altération tant que vous êtes sous forme tutélaire.","implement_group_id":null,"location_id":9,"created_at":"2017-06-09T20:43:05.048Z","updated_at":"2017-06-09T20:43:05.048Z","source":{"id":14,"name":"Le Comptoir de l'Aventure 2","created_at":"2017-06-09T20:42:21.830Z","updated_at":"2017-06-09T20:42:21.830Z"},"object_levels":[{"id":27,"level":27,"price":"1625000","alteration":6,"created_at":"2017-06-09T20:42:22.614Z","updated_at":"2017-06-09T20:42:22.614Z","cons_price":"65000"},{"id":7,"level":7,"price":"2600","alteration":2,"created_at":"2017-06-09T20:42:22.591Z","updated_at":"2017-06-09T20:42:22.591Z","cons_price":"100"},{"id":12,"level":12,"price":"13000","alteration":3,"created_at":"2017-06-09T20:42:22.597Z","updated_at":"2017-06-09T20:42:22.597Z","cons_price":"500"},{"id":17,"level":17,"price":"65000","alteration":4,"created_at":"2017-06-09T20:42:22.603Z","updated_at":"2017-06-09T20:42:22.603Z","cons_price":"2600"},{"id":22,"level":22,"price":"325000","alteration":5,"created_at":"2017-06-09T20:42:22.608Z","updated_at":"2017-06-09T20:42:22.608Z","cons_price":"13000"},{"id":2,"level":2,"price":"520","alteration":1,"created_at":"2017-06-09T20:42:22.584Z","updated_at":"2017-06-09T20:42:22.584Z","cons_price":"25"}],"weapon_groups":[{"id":14,"name":"Pics","created_at":"2017-06-09T20:42:21.887Z","updated_at":"2017-06-09T20:42:21.887Z"},{"id":11,"name":"Mains nues","created_at":"2017-06-09T20:42:21.883Z","updated_at":"2017-06-09T20:42:21.883Z"},{"id":12,"name":"Marteaux","created_at":"2017-06-09T20:42:21.884Z","updated_at":"2017-06-09T20:42:21.884Z"},{"id":13,"name":"Masses","created_at":"2017-06-09T20:42:21.886Z","updated_at":"2017-06-09T20:42:21.886Z"},{"id":3,"name":"Armes d'hast","created_at":"2017-06-09T20:42:21.872Z","updated_at":"2017-06-09T20:42:21.872Z"},{"id":4,"name":"Bâtons","created_at":"2017-06-09T20:42:21.873Z","updated_at":"2017-06-09T20:42:21.873Z"},{"id":5,"name":"Fléaux","created_at":"2017-06-09T20:42:21.875Z","updated_at":"2017-06-09T20:42:21.875Z"},{"id":7,"name":"Haches","created_at":"2017-06-09T20:42:21.877Z","updated_at":"2017-06-09T20:42:21.877Z"},{"id":8,"name":"Lames légères","created_at":"2017-06-09T20:42:21.879Z","updated_at":"2017-06-09T20:42:21.879Z"},{"id":9,"name":"Lames lourdes","created_at":"2017-06-09T20:42:21.880Z","updated_at":"2017-06-09T20:42:21.880Z"},{"id":10,"name":"Lances","created_at":"2017-06-09T20:42:21.881Z","updated_at":"2017-06-09T20:42:21.881Z"}],"armor_categories":[],"location":{"id":9,"name":"Arme","code":"weapon","created_at":"2017-06-09T20:42:22.637Z","updated_at":"2017-06-09T20:42:22.637Z"}},{"id":115,"name":"Arbalète d'averse boisée","description":"Vous appuyez sur la détente et les échardes pleuvent sur vos ennemis","alteration":"jets d'attaque et jets de dégâts","property":"","power":"Quotidien: action simple. Effectuez une attaque de base à distance avec cette arbalète contre chaque créature prise dans une décharge de proximité 3.\u003cbr\u003eNiveau 17 ou 22: décharge de proximité 5; toute créature touchée est également poussée de 2 cases. Niveau 27: décharge de proximité 7; toute créature touchée est également poussée de 2 cases.","special":"","source_id":14,"rarity":"uncommon","critical":"+1d6 dégâts par point de bonus d'altération","implement_group_id":null,"location_id":9,"created_at":"2017-06-09T20:43:05.080Z","updated_at":"2017-06-09T20:43:05.080Z","source":{"id":14,"name":"Le Comptoir de l'Aventure 2","created_at":"2017-06-09T20:42:21.830Z","updated_at":"2017-06-09T20:42:21.830Z"},"object_levels":[{"id":7,"level":7,"price":"2600","alteration":2,"created_at":"2017-06-09T20:42:22.591Z","updated_at":"2017-06-09T20:42:22.591Z","cons_price":"100"},{"id":12,"level":12,"price":"13000","alteration":3,"created_at":"2017-06-09T20:42:22.597Z","updated_at":"2017-06-09T20:42:22.597Z","cons_price":"500"},{"id":17,"level":17,"price":"65000","alteration":4,"created_at":"2017-06-09T20:42:22.603Z","updated_at":"2017-06-09T20:42:22.603Z","cons_price":"2600"},{"id":22,"level":22,"price":"325000","alteration":5,"created_at":"2017-06-09T20:42:22.608Z","updated_at":"2017-06-09T20:42:22.608Z","cons_price":"13000"},{"id":27,"level":27,"price":"1625000","alteration":6,"created_at":"2017-06-09T20:42:22.614Z","updated_at":"2017-06-09T20:42:22.614Z","cons_price":"65000"}],"weapon_groups":[{"id":1,"name":"Arbalètes","created_at":"2017-06-09T20:42:21.868Z","updated_at":"2017-06-09T20:42:21.868Z"}],"armor_categories":[],"location":{"id":9,"name":"Arme","code":"weapon","created_at":"2017-06-09T20:42:22.637Z","updated_at":"2017-06-09T20:42:22.637Z"}},{"id":116,"name":"Arc du duelliste","description":"Quand cette puissante arme vrombit à l'enchaînement des flèches, les archers ennemis sont promis à la défaite.","alteration":"jets d'attaque et jets de dégâts","property":"Lorsque vous touchez un ennemi avec cette arme, il subit un malus de -2 aux jets d'attaques à distance et de zone jusqu'à la fin de votre tour de jeu suivant.","power":"","special":"","source_id":14,"rarity":"uncommon","critical":"+1d6 dégâts par point de bonus d'altération","implement_group_id":null,"location_id":9,"created_at":"2017-06-09T20:43:05.098Z","updated_at":"2017-06-09T20:43:05.098Z","source":{"id":14,"name":"Le Comptoir de l'Aventure 2","created_at":"2017-06-09T20:42:21.830Z","updated_at":"2017-06-09T20:42:21.830Z"},"object_levels":[{"id":27,"level":27,"price":"1625000","alteration":6,"created_at":"2017-06-09T20:42:22.614Z","updated_at":"2017-06-09T20:42:22.614Z","cons_price":"65000"},{"id":2,"level":2,"price":"520","alteration":1,"created_at":"2017-06-09T20:42:22.584Z","updated_at":"2017-06-09T20:42:22.584Z","cons_price":"25"},{"id":7,"level":7,"price":"2600","alteration":2,"created_at":"2017-06-09T20:42:22.591Z","updated_at":"2017-06-09T20:42:22.591Z","cons_price":"100"},{"id":12,"level":12,"price":"13000","alteration":3,"created_at":"2017-06-09T20:42:22.597Z","updated_at":"2017-06-09T20:42:22.597Z","cons_price":"500"},{"id":17,"level":17,"price":"65000","alteration":4,"created_at":"2017-06-09T20:42:22.603Z","updated_at":"2017-06-09T20:42:22.603Z","cons_price":"2600"},{"id":22,"level":22,"price":"325000","alteration":5,"created_at":"2017-06-09T20:42:22.608Z","updated_at":"2017-06-09T20:42:22.608Z","cons_price":"13000"}],"weapon_groups":[{"id":2,"name":"Arcs","created_at":"2017-06-09T20:42:21.871Z","updated_at":"2017-06-09T20:42:21.871Z"}],"armor_categories":[],"location":{"id":9,"name":"Arme","code":"weapon","created_at":"2017-06-09T20:42:22.637Z","updated_at":"2017-06-09T20:42:22.637Z"}},{"id":117,"name":"Arc du maître franc-tireur","description":"Parfaitement équilibré et animé de pouvoirs qui façonnent chacun de vos gestes, cet arc vous permet de combattre avec une grâce hors pair.","alteration":"jets d'attaque et jets de dégâts","property":"","power":"Rencontre: action libre.Déclencheur: vous effectuez une attaque de base à distance en utilisant cette arme.Effet: au lieu de cette attaque de base, vous effectuez une attaque à volonté à distance avec cette arme.","special":"","source_id":14,"rarity":"uncommon","critical":"+1d6 dégâts par point de bonus d'altération","implement_group_id":null,"location_id":9,"created_at":"2017-06-09T20:43:05.116Z","updated_at":"2017-06-09T20:43:05.116Z","source":{"id":14,"name":"Le Comptoir de l'Aventure 2","created_at":"2017-06-09T20:42:21.830Z","updated_at":"2017-06-09T20:42:21.830Z"},"object_levels":[{"id":15,"level":15,"price":"25000","alteration":3,"created_at":"2017-06-09T20:42:22.601Z","updated_at":"2017-06-09T20:42:22.601Z","cons_price":"1000"},{"id":20,"level":20,"price":"125000","alteration":4,"created_at":"2017-06-09T20:42:22.606Z","updated_at":"2017-06-09T20:42:22.606Z","cons_price":"5000"},{"id":25,"level":25,"price":"625000","alteration":5,"created_at":"2017-06-09T20:42:22.612Z","updated_at":"2017-06-09T20:42:22.612Z","cons_price":"25000"},{"id":30,"level":30,"price":"3125000","alteration":6,"created_at":"2017-06-09T20:42:22.617Z","updated_at":"2017-06-09T20:42:22.617Z","cons_price":"125000"},{"id":10,"level":10,"price":"5000","alteration":2,"created_at":"2017-06-09T20:42:22.595Z","updated_at":"2017-06-09T20:42:22.595Z","cons_price":"200"}],"weapon_groups":[{"id":2,"name":"Arcs","created_at":"2017-06-09T20:42:21.871Z","updated_at":"2017-06-09T20:42:21.871Z"}],"armor_categories":[],"location":{"id":9,"name":"Arme","code":"weapon","created_at":"2017-06-09T20:42:22.637Z","updated_at":"2017-06-09T20:42:22.637Z"}},{"id":118,"name":"Arc hurleur","description":"Ce qui débute comme un gémissement grave se transforme en crissement strident tandis que la flèche cherche sa cible.","alteration":"jets d'attaque et jets de dégâts","property":"Lorsque vous utilisez cette arme pour toucher un ennemi avec un pouvoir d'attaque qui n'a pas de type de dégâts, l'attaque inflige des dégâts de tonnerre et l'ennemi est assourdi jusqu'à la fin de votre tour de jeu suivant.","power":"Quotidien: action libre:Déclencheur: vous touchez un ennemi avec cette arme.Effet: cet ennemi subit une vulnérabilité tonnerre 5 (sauvegarde annule).Chaque créature adjacente à cet ennemi est assourdie et subit une vulnérabilité tonnerre 5 jusqu'à la fin de votre tour de jeu suivant.\u003cbr\u003eNiveau 14 ou 19: l'ennemi subit une vulnérabilité tonnerre 10 (sauvegarde annule).\u003cbr\u003eNiveau 24 ou 29: l'ennemi subit une vulnérabilité tonnerre 20 (sauvegarde annule).","special":"","source_id":14,"rarity":"uncommon","critical":"+1d6 dégâts de tonnerre par point de bonus d'altération","implement_group_id":null,"location_id":9,"created_at":"2017-06-09T20:43:05.132Z","updated_at":"2017-06-09T20:43:05.132Z","source":{"id":14,"name":"Le Comptoir de l'Aventure 2","created_at":"2017-06-09T20:42:21.830Z","updated_at":"2017-06-09T20:42:21.830Z"},"object_levels":[{"id":4,"level":4,"price":"840","alteration":1,"created_at":"2017-06-09T20:42:22.587Z","updated_at":"2017-06-09T20:42:22.587Z","cons_price":"40"},{"id":14,"level":14,"price":"21000","alteration":3,"created_at":"2017-06-09T20:42:22.599Z","updated_at":"2017-06-09T20:42:22.599Z","cons_price":"800"},{"id":19,"level":19,"price":"105000","alteration":4,"created_at":"2017-06-09T20:42:22.605Z","updated_at":"2017-06-09T20:42:22.605Z","cons_price":"4200"},{"id":24,"level":24,"price":"525000","alteration":5,"created_at":"2017-06-09T20:42:22.611Z","updated_at":"2017-06-09T20:42:22.611Z","cons_price":"21000"},{"id":29,"level":29,"price":"2625000","alteration":6,"created_at":"2017-06-09T20:42:22.616Z","updated_at":"2017-06-09T20:42:22.616Z","cons_price":"105000"},{"id":9,"level":9,"price":"4200","alteration":2,"created_at":"2017-06-09T20:42:22.594Z","updated_at":"2017-06-09T20:42:22.594Z","cons_price":"160"}],"weapon_groups":[{"id":2,"name":"Arcs","created_at":"2017-06-09T20:42:21.871Z","updated_at":"2017-06-09T20:42:21.871Z"}],"armor_categories":[],"location":{"id":9,"name":"Arme","code":"weapon","created_at":"2017-06-09T20:42:22.637Z","updated_at":"2017-06-09T20:42:22.637Z"}}]`
  constructor(private http: HttpClient) { }

  /** GET magic items from the server */
  getMagicItems(): Observable<MagicItem[]> {
    return this.http.get<MagicItem[]>(this.railsServer + this.magicItemsUrl)
      .pipe(catchError(this.handleError('getMagicItems', JSON.parse(this.mockMagicItems2))));
  }

  /**
   * Handle Http operation that failed.
   * Let the app continue.
   * @param operation - name of the operation that failed
   * @param result - optional value to return as the observable result
   */
  private handleError<T> (operation = 'operation', result?: T) {
    return (error: any): Observable<T> => {
      console.error(error); // log to console instead
      return of(result as T);
    }
  };
}
